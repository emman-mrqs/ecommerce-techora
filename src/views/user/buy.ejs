<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TECHORA Products | Shop Now</title>

  <!-- External Styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <!-- Your page CSS (note the leading slash so it loads correctly) -->
  <link rel="stylesheet" href="/css/buy.css"/>
</head>

<body>
  <!-- Header -->
    <header>
        <%- include("../partials/header.ejs") %>
    </header>

    <!-- Page container centers the content -->
    <main class="page">
    <section class="product-detail" role="region" aria-label="Product details">
        
        <!-- Gallery -->
        <aside class="product-gallery" aria-label="Product images">
        <figure class="main-image">
            <img 
            src="<%= images[0]?.img_url || '/images/default.png' %>" 
            alt="<%= product.name %> main image"
            id="mainProductImage"
            />
        </figure>

        <div class="image-thumbnails" role="list">
            <% images.forEach((img, index) => { %>
            <img 
                role="listitem"
                src="<%= img.img_url %>" 
                alt="Image <%= index + 1 %>" 
                class="<%= index === 0 ? 'active' : '' %>" 
                onclick="document.getElementById('mainProductImage').src = '<%= img.img_url %>'"
            />
            <% }); %>
        </div>
        </aside>

        <!-- Info -->
        <section class="product-info">
        <h1 class="product-title"><%= product.name %></h1>
        <p class="product-description"><%= product.description %></p>

        <!-- Price Range -->
        <div class="price-range" aria-live="polite">
            <% 
            const prices = variants.map(v => parseFloat(v.price));
            const minPrice = Math.min(...prices).toFixed(2);
            const maxPrice = Math.max(...prices).toFixed(2);
            %>
            <div class="price">₱<%= minPrice %> – ₱<%= maxPrice %></div>
        </div>

        <!-- Variants -->
        <div class="variant-section">
            <!-- Color Options -->
            <label class="variant-label" for="color-options">Color:</label>
            <div id="color-options" class="variant-options" role="group" aria-label="Color options">
            <% 
                const colors = [...new Set(variants.map(v => v.color))];
                colors.forEach(color => { 
            %>
                <button type="button" class="variant-btn" aria-pressed="false"><%= color %></button>
            <% }); %>
            </div>

            <!-- Storage Options -->
            <label class="variant-label" for="storage-options">Storage:</label>
            <div id="storage-options" class="variant-options" role="group" aria-label="Storage options">
            <% 
                const storages = [...new Set(variants.map(v => v.storage))];
                storages.forEach(storage => { 
            %>
                <button type="button" class="variant-btn" aria-pressed="false"><%= storage %>GB</button>
            <% }); %>
            </div>
        </div>

        <!-- Quantity & Stock -->
        <div class="quantity-section">
            <label class="variant-label" for="qty-input">Quantity:</label>
            <div class="quantity-control">
            <button type="button" class="qty-btn" aria-label="Decrease quantity">−</button>
            <input id="qty-input" type="number" min="1" value="1" inputmode="numeric" />
            <button type="button" class="qty-btn" aria-label="Increase quantity">+</button>
            </div>

            <% 
            const totalStock = variants.reduce((sum, v) => sum + parseInt(v.stock_quantity), 0); 
            %>
            <span class="stock-info">In Stock: <%= totalStock %></span>
        </div>

        <!-- Buttons -->
        <div class="action-buttons">
            <button class="btn-outline" type="button">Add to Cart</button>
            <button class="btn-solid" type="button">Buy Now</button>
        </div>
        </section>
    </section>
    
    </main>


    <!-- Footer -->
    <footer>
        <%-// include("../partials/footer.ejs") %>
    </footer>

    

    </body>
</html>
