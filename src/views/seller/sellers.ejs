<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Sellers â€” Techora</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <style>
    :root{
      --bg:#FFFFFF; --ink:#0A0A0A; --muted:#4D4D4D; --line:#E0E0E0; --card:#FAFAFA;
      --btn:#000; --btnText:#fff; --hover:#333;
      --radius:16px;
    }
    html,body{background:#fff;color:var(--ink)}
    .page{max-width:1200px;margin:0 auto;padding:24px 16px 56px}

    /* enter / reveal */
    [data-animate]{opacity:0;transform:translateY(12px);transition:all .45s cubic-bezier(.2,.8,.2,1)}
    [data-animate].in{opacity:1;transform:none}

    /* seller card */
    .seller-card{
      display:flex;align-items:center;gap:18px;flex-wrap:wrap;
      background:#fff;border:1px solid var(--line);border-radius:18px;padding:16px 18px;
      box-shadow:0 8px 22px rgba(0,0,0,.05);
      transition:transform .18s ease, box-shadow .24s ease, border-color .24s ease;
    }
    .seller-card:hover{transform:translateY(-2px);box-shadow:0 14px 30px rgba(0,0,0,.08);border-color:#dcdcdc}

    .avatar{
      width:64px;height:64px;border-radius:50%;display:grid;place-items:center;
      border:1px solid var(--line);background:#0A0A0A;color:#fff;font-weight:800;letter-spacing:.5px;
      text-transform:uppercase;
      background-image: radial-gradient(120% 120% at 30% 30%, #1A1A1A 0%, #000 60%, #000 100%);
    }
    .avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%}

    .seller-name{font-weight:700;font-size:18px;color:var(--ink)}
    .seller-follow{color:var(--muted);font-size:14px;margin-top:2px}

    .stats{margin-left:auto;display:flex;gap:32px;flex-wrap:wrap}
    .stat{min-width:92px;text-align:center}
    .stat .lbl{font-size:12px;color:var(--muted)}
    .stat .val{font-weight:800}

    .card-btn{
      border:1px solid var(--btn); color:var(--btn);
      background:transparent; border-radius:10px; padding:8px 14px; font-weight:700;
      transition:background .15s ease, color .15s ease;
    }
    .card-btn:hover{background:#000;color:#fff}

    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width: 768px){ .grid{grid-template-columns:1fr} }

    /* header chip & bar */
    .headbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:.45rem;padding:.35rem .7rem;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--muted)}
    .title{font-weight:800;font-size:22px}

    /* pagination */
    .pager{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:22px;flex-wrap:wrap}
    .page-btn{
      display:inline-flex;align-items:center;justify-content:center;min-width:36px;height:36px;
      border:1px solid #000;background:#fff;color:#000;border-radius:10px;text-decoration:none;font-weight:700
    }
    .page-btn:hover{background:#f6f6f6}
    .page-btn.active{background:#000;color:#fff}
    .page-btn.disabled{opacity:.4;pointer-events:none}
  </style>
</head>

<body>
  <header><%- include("../partials/header.ejs") %></header>

  <main class="page">
    <section class="headbar mb-3" data-animate>
      <div class="title">All Sellers</div>
      <% if (search) { %>
        <span class="chip"><i class="fa-solid fa-magnifying-glass"></i> <span>Search: "<%= search %>"</span></span>
      <% } %>
    </section>

    <section class="grid" data-animate>
      <% if ((sellers||[]).length) { %>
        <% sellers.forEach(s => { 
             const initials = (s.store_name||'')
               .split(/\s+/)
               .filter(Boolean)
               .slice(0,2)
               .map(w=>w[0])
               .join('')
               .toUpperCase();
        %>
          <article class="seller-card">
            <div class="avatar">
              <% if (s.store_icon) { %>
                <img src="<%= s.store_icon %>" alt="<%= s.store_name %> logo" onerror="this.remove();this.parentElement.textContent='<%= initials %>';">
              <% } else { %>
                <%= initials %>
              <% } %>
            </div>

            <div>
              <div class="seller-name"><%= s.store_name %></div>
              <div class="seller-follow">0 Followers</div>
            </div>

            <div class="stats">
              <div class="stat">
                <div class="lbl">Products</div>
                <div class="val"><%= s.product_count %></div>
              </div>
              <div class="stat">
                <div class="lbl">Rating</div>
                <div class="val"><%= Number(s.avg_rating||0).toFixed(1) %></div>
              </div>
              <div class="stat">
                <div class="lbl">Response</div>
                <div class="val">Within minutes</div>
              </div>
              <div class="d-flex align-items-center">
<a class="card-btn" href="/store/<%= s.id %>">View store</a>
              </div>
            </div>
          </article>
        <% }) %>
      <% } else { %>
        <div class="text-muted">No sellers found.</div>
      <% } %>
    </section>

    <!-- Pagination -->
    <%
      const makeHref = (p) => {
        const qs = [];
        qs.push(`page=${p}`);
        if (typeof search !== 'undefined' && search) qs.push(`search=${encodeURIComponent(search)}`);
        return `?${qs.join('&')}`;
      };
      const windowSize = 10;
      const currentWindow = Math.floor((page-1)/windowSize);
      const start = currentWindow * windowSize + 1;
      const end = Math.min(start + windowSize - 1, totalPages);
    %>
    <nav class="pager" aria-label="Pagination" data-animate>
      <a class="page-btn <%= page<=1?'disabled':'' %>" href="<%= page<=1 ? '#' : makeHref(page-1) %>">&lt;</a>
      <% for (let p=start; p<=end; p++){ %>
        <a class="page-btn <%= p===page?'active':'' %>" href="<%= makeHref(p) %>"><%= p %></a>
      <% } %>
      <a class="page-btn <%= page>=totalPages?'disabled':'' %>" href="<%= page>=totalPages ? '#' : makeHref(page+1) %>">&gt;</a>
    </nav>
  </main>

  <footer><%- include("../partials/footer.ejs") %></footer>

  <script>
    // reveal on scroll
    const io=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('in');io.unobserve(e.target)}}),{threshold:.12});
    document.querySelectorAll('[data-animate]').forEach(el=>io.observe(el));
  </script>
</body>
</html>
