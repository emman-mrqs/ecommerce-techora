<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Earnings Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/sellerEarnings.css">
</head>
<body>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Header and Sidebar-->
        <%- include("../partials/sellerSideBarNav.ejs") %>

        <!-- Page Content -->
        <div class="page-content">
            <div class="container-fluid">
                <div class="main-container">
                    <h1 class="earnings-title">Earnings</h1>
                    
                    <!-- Stats Cards Row -->
                    <div class="row mb-4">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card stats-card total-sales-card">
                                <div class="stat-label">Total Sales</div>
                                <div class="stat-value currency">
                                    ₱<%= (monthNow?.grossSales ?? 0).toFixed(2) %>
                                </div>
                                <div class="stat-sublabel">This Month</div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card stats-card monthly-best-fee">
                                <div class="stat-label">Monthly Rent Fee</div>
                                <div class="stat-value currency">
                                    ₱<%= (monthNow?.rentFee ?? 0).toFixed(2) %>
                                </div>
                                <div class="stat-sublabel">5% of total sales</div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card stats-card transaction-fees">
                                <div class="stat-label">Transaction Fees</div>
                                <div class="stat-value currency">
                                    ₱<%= (monthNow?.txnFees ?? 0).toFixed(2) %>
                                </div>
                                <div class="stat-sublabel">2% per sale</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Net Earnings Card -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card stats-card net-earnings-card">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="stat-label">Net Earnings</div>
                                        <div class="stat-sublabel">After deducting fees</div>
                                    </div>
                                    <div class="col-md-4 text-md-end">
                                        <div class="stat-value net-earnings-value currency">
                                            ₱<%= (monthNow?.netEarning ?? 0).toFixed(2) %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sales Breakdown -->
                    <div class="breakdown-section">
                        <h2 class="breakdown-title">Sales Breakdown</h2>
                        <p class="breakdown-subtitle">Detailed view of each product sale and associated fees</p>
                        
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Product Name</th>
                                        <th>Unit Price</th>
                                        <th>Qty</th>
                                        <th>Total Sale</th>
                                        <th>Transaction Fee</th>
                                        <th>Net Earnings</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (!breakdown || !breakdown.length) { %>
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                No completed sales this month.
                                            </td>
                                        </tr>
                                    <% } else { %>
                                        <% breakdown.forEach(row => { %>
                                            <tr>
                                                <td><%= row.product_name %></td>
                                                <td class="currency">₱<%= Number(row.unit_price).toFixed(2) %></td>
                                                <td><%= row.quantity %></td>
                                                <td class="currency">₱<%= Number(row.line_total).toFixed(2) %></td>
                                                <td class="fee-negative currency">-₱<%= Number(row.txn_fee).toFixed(2) %></td>
                                                <td class="earnings-positive currency">₱<%= Number(row.line_net).toFixed(2) %></td>
                                                <td><%= row.order_date %></td>
                                            </tr>
                                        <% }) %>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Past Months History -->
                    <div class="breakdown-section mt-4">
                        <h2 class="breakdown-title">Past Months</h2>
                        <p class="breakdown-subtitle">Your sales summary for recent months</p>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Orders</th>
                                        <th>Units</th>
                                        <th>Gross Sales</th>
                                        <th>Rent (5%)</th>
                                        <th>Txn Fees (2%)</th>
                                        <th>Net</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (!history || !history.length) { %>
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                No history yet.
                                            </td>
                                        </tr>
                                    <% } else { %>
                                        <% history.forEach(h => { %>
                                            <tr>
                                                <td>
                                                    <%= new Date(h.month).toLocaleString('en-US', { month: 'long', year: 'numeric' }) %>
                                                </td>
                                                <td><%= h.orders %></td>
                                                <td><%= h.units %></td>
                                                <td class="currency">₱<%= Number(h.gross_sales).toFixed(2) %></td>
                                                <td class="fee-negative currency">-₱<%= Number(h.rent_fee).toFixed(2) %></td>
                                                <td class="fee-negative currency">-₱<%= Number(h.txn_fees).toFixed(2) %></td>
                                                <td class="earnings-positive currency">₱<%= Number(h.net_earning).toFixed(2) %></td>
                                            </tr>
                                        <% }) %>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Summary Statistics -->
                    <div class="summary-stats">
                        <div class="row">
                            <div class="col-md-4 summary-item">
                                <div class="summary-value"><%= (summary?.unitsSold ?? 0) %></div>
                                <div class="summary-label">Total Products Sold</div>
                            </div>
                            <div class="col-md-4 summary-item">
                                <div class="summary-value currency">₱<%= (summary?.avgSaleValue ?? 0).toFixed(2) %></div>
                                <div class="summary-label">Average Sale Value</div>
                            </div>
                            <div class="col-md-4 summary-item">
                                <div class="summary-value"><%= (summary?.transactions ?? 0) %></div>
                                <div class="summary-label">Total Transactions</div>
                            </div>
                        </div>
                    </div>

                </div><!-- /.main-container -->
            </div><!-- /.container-fluid -->
        </div><!-- /.page-content -->
    </div><!-- /.main-content -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="js/sellerEarnings"></script>
</body>
</html>
